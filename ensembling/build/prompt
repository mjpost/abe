#!/usr/bin/env python

# ensembling/build/prompt "Translate the following sentence from English to French:"
# wmt14 {"decoder_inputs": Translate the following sentence from English to French: ```Jet makers feud over seat width with big orders at stake```}

import sys
import json

prompt=sys.argv[1]

if len(sys.argv) > 2:
    SOURCE = sys.argv[2]
    TARGET = sys.argv[3]
else:
    SOURCE = None
    TARGET = None

TOWER = "<|im_start|>user\nTranslate the following text from ```SOURCE``` into ```TARGET```.\n```SOURCE```: ```INPUT_TEXT```\n```TARGET```:<|im_end|>\n<|im_start|>assistant\n"
#LLAMA3 = "'<|begin_of_text|><|start_header_id|>system<|end_header_id|>\n\nCutting Knowledge Date: December 2023\nToday Date: 26 Jul 2024\n\nYou are a pirate chatbot who always responds in pirate speak!<|eot_id|><|start_header_id|>user<|end_header_id|>\n\nWho are you?<|eot_id|><|start_header_id|>assistant<|end_header_id|>\n\n'"

LLAMA3 = "<|begin_of_text|><|start_header_id|>user<|end_header_id|>\n\nTranslate the following segment into ```TARGET```. The ```SOURCE``` segment: ```INPUT_TEXT```<|eot_id|><|start_header_id|>assistant<|end_header_id|>\n\n"


if prompt == "tower":
    template = TOWER
elif prompt == "llama3":
    template = LLAMA3

for line in sys.stdin:
    if SOURCE is not None:
        template = template.replace("```SOURCE```", SOURCE)
    if TARGET is not None:
        template = template.replace("```TARGET```", TARGET)
    prompt_input = template.replace("```INPUT_TEXT```", line.strip())
    print(json.dumps({
        "decoder_inputs": prompt_input
    }))
